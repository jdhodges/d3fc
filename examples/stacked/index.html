
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Stacked Bar</title>
    <meta name="description" content="A collection of components that make it easy to build interactive charts with D3.">

    <script src="../../scripts.js"></script>

    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-96x96.png" sizes="96x96">
    <link rel="stylesheet" href="../../styles.css" />
    
  </head>
  <body>
    <div class="content">

      <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
              <a href="../../"><img class="navbar-logo" alt="d3fc" src="../../images/logo.svg" /></a>
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="../..#quick-start">Quick Start</a></li>
                <li class=""><a href="../../components/introduction/1-getting-started.html">Documentation</a></li>
                <li class="active"><a href="../../examples">Examples</a></li>
                <li class=""><a href="../../playground">Playground</a></li>
                <li><a href="https://github.com/ScottLogic/d3fc">GitHub</a></li>
              </ul>
            </div>
        </div>
      </nav>

      
<div class="container example">

  <div class="row">

    <div class="col-sm-9 col-xs-12">
      <h1>
        Stacked Bar

        
        <a href="../../playground/playground.html?example=examples/stacked/index">View in the Playground</a>
        
      </h1>

      <style>
#example-chart {
  margin-bottom: 20px;
  width: 100%;
  height: 400px;
}
.bar path {
  stroke-width: 0;
}
.x-axis .label {
  text-anchor: start;
}
.cartesian-chart .background {
  fill: transparent;
  stroke: transparent;
}
</style>

<div id='example-chart'></div>


<script>
d3.csv('data.csv', function(error, data) {
  // manipulate the data into stacked series
  var spread = fc.data.spread()
      .xValueKey('Country');
  var stack = d3.layout.stack()
      .values(function(d) { return d.values; });

  var series = stack(spread(data));

  var color = d3.scale.category20()
    .domain(series.map(function(s) { return s.key; }));

  var yExtent = fc.util.extent()
      .include(0)
      .fields(function(d) { return d.y + d.y0; });

  var legend = d3.legend.color()
    .orient('horizontal')
    .shapeWidth(70)
    .scale(color);

  var stack = fc.series.stacked.bar()
      .orient('horizontal')
      .yValue(function(d) { return d.x; })
      .xValue(function(d) { return d.y0 + d.y; })
      .x0Value(function(d) { return d.y0; })
      .decorate(function(sel, data, index) {
          sel.enter().attr('fill', color(series[index].key));
      });

  var chart = fc.chart.cartesian(
                    d3.scale.linear(),
                    d3.scale.ordinal())
          .xDomain(yExtent(series.map(function(d) { return d.values; })))
          .yDomain(data.map(function(d) { return d.Country; }))
          .xLabel('2013 Energy Production (million tonnes of oil equivalent)')
          .xNice()
          .yOrient('left')
          .yTickSize(0)
          .margin({left: 100, bottom: 40, right: 10})
          .plotArea(stack)
          .decorate(function(selection) {
              selection.enter()
                  .append('g')
                  .layout({
                      position: 'absolute',
                      right: 10,
                      top: 20,
                      width: 358,
                      height: 36
                  })
                  .call(legend);

              // compute layout from the parent SVG
              selection.enter().layout();
          });

  // render
  d3.select('#example-chart')
      .datum(series)
      .call(chart);
});

</script>

<p>This example demonstrates how a stacked bar chart using energy production data from <a href="http://ec.europa.eu/eurostat/statistics-explained/index.php">eurostat</a>. The chart is constructed from the following components:</p>
<ul>
<li>A <a href="/components/chart/cartesian.html">cartesian chart</a>, with an ordinal y axis and a linear x axis.</li>
<li>The data is prepared using the <a href="/components/data/spread.html">spread</a> component, which creates a two dimensional array of data, followed by a d3 stack layout, which stacks the &#39;y&#39; values.</li>
<li>The data is rendered via a horizontally oriented <a href="/components/series/stacked.html">stacked bar series</a>.</li>
<li>The <a href="/components/introduction/2-decorate-pattern.html">decorate pattern</a> is also used to add a legend (courtesy of the <a href="http://d3-legend.susielu.com">d3-legend</a> project). In this case, the legend is inserted into the SVG via the enter selection, with <a href="/components/layout/layout.html">svg flexbox</a> used for positioning.</li>
</ul>
<pre><code class="language-js">d3.csv(<span class="string">'data.csv'</span>, <span class="function"><span class="keyword">function</span><span class="params">(error, data)</span> {</span>
  <span class="comment">// manipulate the data into stacked series</span>
  <span class="keyword">var</span> spread = fc.data.spread()
      .xValueKey(<span class="string">'Country'</span>);
  <span class="keyword">var</span> stack = d3.layout.stack()
      .values(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.values; });

  <span class="keyword">var</span> series = stack(spread(data));

  <span class="keyword">var</span> color = d3.scale.category20()
    .domain(series.map(<span class="function"><span class="keyword">function</span><span class="params">(s)</span> {</span> <span class="keyword">return</span> s.key; }));

  <span class="keyword">var</span> yExtent = fc.util.extent()
      .include(<span class="number">0</span>)
      .fields(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.y + d.y0; });

  <span class="keyword">var</span> legend = d3.legend.color()
    .orient(<span class="string">'horizontal'</span>)
    .shapeWidth(<span class="number">70</span>)
    .scale(color);

  <span class="keyword">var</span> stack = fc.series.stacked.bar()
      .orient(<span class="string">'horizontal'</span>)
      .yValue(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.x; })
      .xValue(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.y0 + d.y; })
      .x0Value(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.y0; })
      .decorate(<span class="function"><span class="keyword">function</span><span class="params">(sel, data, index)</span> {</span>
          sel.enter().attr(<span class="string">'fill'</span>, color(series[index].key));
      });

  <span class="keyword">var</span> chart = fc.chart.cartesian(
                    d3.scale.linear(),
                    d3.scale.ordinal())
          .xDomain(yExtent(series.map(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.values; })))
          .yDomain(data.map(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.Country; }))
          .xLabel(<span class="string">'2013 Energy Production (million tonnes of oil equivalent)'</span>)
          .xNice()
          .yOrient(<span class="string">'left'</span>)
          .yTickSize(<span class="number">0</span>)
          .margin({left: <span class="number">100</span>, bottom: <span class="number">40</span>, right: <span class="number">10</span>})
          .plotArea(stack)
          .decorate(<span class="function"><span class="keyword">function</span><span class="params">(selection)</span> {</span>
              selection.enter()
                  .append(<span class="string">'g'</span>)
                  .layout({
                      position: <span class="string">'absolute'</span>,
                      right: <span class="number">10</span>,
                      top: <span class="number">20</span>,
                      width: <span class="number">358</span>,
                      height: <span class="number">36</span>
                  })
                  .call(legend);

              <span class="comment">// compute layout from the parent SVG</span>
              selection.enter().layout();
          });

  <span class="comment">// render</span>
  d3.select(<span class="string">'#example-chart'</span>)
      .datum(series)
      .call(chart);
});</code></pre>


      <nav class="visible-xs-block">
        <ul class="pager">
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                    <li class="previous"><a href="../simple/index.html"><span aria-hidden="true">&larr;</span> Line / Area Chart</a></li>
                  
                  
                
                  
                  
                
                  
                  
                    <li class="next"><a href="../wealth-and-health-of-nations/index.html">The Wealth &amp; Health of Nations <span aria-hidden="true">&rarr;</span></a></li>
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
                  
                  
                
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </div>

    <nav class="col-sm-3 hidden-xs">
      <ul class="nav nav-stacked fixed nav-sidebar">
        
          <li>
            
              
                <h4>Examples</h4>
              
            
            <ul class="nav nav-stacked">
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                    <li class="">
                      <a href="../basecoin/index.html">
                        Basecoin
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../bubble/index.html">
                        Bubble chart
                      </a>
                    </li>
                
              
                
              
                
                    <li class="">
                      <a href="../low-barrel/index.html">
                        Low Barrel
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../scatter/index.html">
                        Scatterplot
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../simple/index.html">
                        Line / Area Chart
                      </a>
                    </li>
                
              
                
                    <li class="active">
                      <a href="index.html">
                        Stacked Bar
                      </a>
                    </li>
                
              
                
                    <li class="">
                      <a href="../wealth-and-health-of-nations/index.html">
                        The Wealth &amp; Health of Nations
                      </a>
                    </li>
                
              
                
              
                
              
                
              
                
              
            </ul>
          </li>
        
      </ul>
    </nav>

  </div>

</div>


    </div>
    <footer>
      <div class="container">
        <p class="muted credit text-center">Project supported by <a href="http://www.scottlogic.com">Scott Logic</a>.</p>
        <p class="muted credit text-center">Browser testing provided by <a class="browserstack" href="https://browserstack.com">BrowserStack</a>.</p>
      </div>
    </footer>

    
    
    <script src="//localhost:35729/livereload.js"></script>
  </body>
</html>
