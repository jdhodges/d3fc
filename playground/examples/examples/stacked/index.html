<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stacked Bar</title>
    <link href="../d3fc.css" rel="stylesheet" />
    <!-- https://cdnjs.cloudflare.com/ajax/libs/d3fc/5.1.0/d3fc.min.css -->
</head>
<body>
<style>
#example-chart {
  margin-bottom: 20px;
  width: 100%;
  height: 400px;
}
.bar path {
  stroke-width: 0;
}
.x-axis .label {
  text-anchor: start;
}
.cartesian-chart .background {
  fill: transparent;
  stroke: transparent;
}
</style>

<div id='example-chart'></div>


    <script src="../d3fc.bundle.js"></script>
    <!-- https://cdnjs.cloudflare.com/ajax/libs/d3fc/5.1.0/d3fc.bundle.min.js -->

    <script data-src="index.js">
d3.csv('data.csv', function(error, data) {
  // manipulate the data into stacked series
  var spread = fc.data.spread()
      .xValueKey('Country');
  var stack = d3.layout.stack()
      .values(function(d) { return d.values; });

  var series = stack(spread(data));

  var color = d3.scale.category20()
    .domain(series.map(function(s) { return s.key; }));

  var yExtent = fc.util.extent()
      .include(0)
      .fields(function(d) { return d.y + d.y0; });

  var legend = d3.legend.color()
    .orient('horizontal')
    .shapeWidth(70)
    .scale(color);

  var stack = fc.series.stacked.bar()
      .orient('horizontal')
      .yValue(function(d) { return d.x; })
      .xValue(function(d) { return d.y0 + d.y; })
      .x0Value(function(d) { return d.y0; })
      .decorate(function(sel, data, index) {
          sel.enter().attr('fill', color(series[index].key));
      });

  var chart = fc.chart.cartesian(
                    d3.scale.linear(),
                    d3.scale.ordinal())
          .xDomain(yExtent(series.map(function(d) { return d.values; })))
          .yDomain(data.map(function(d) { return d.Country; }))
          .xLabel('2013 Energy Production (million tonnes of oil equivalent)')
          .xNice()
          .yOrient('left')
          .yTickSize(0)
          .margin({left: 100, bottom: 40, right: 10})
          .plotArea(stack)
          .decorate(function(selection) {
              selection.enter()
                  .append('g')
                  .layout({
                      position: 'absolute',
                      right: 10,
                      top: 20,
                      width: 358,
                      height: 36
                  })
                  .call(legend);

              // compute layout from the parent SVG
              selection.enter().layout();
          });

  // render
  d3.select('#example-chart')
      .datum(series)
      .call(chart);
});

    </script>
</body>
</html>
